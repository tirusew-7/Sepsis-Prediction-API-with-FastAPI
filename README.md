# Sepsis Prediction 
Sepsis is a life-threatening medical condition characterized by a systemic inflammatory response to infection, leading to organ dysfunction and failure.

The project aims to predict sepsis by utilizing a predictive model that takes into account various input features, including Plasma glucose level, Blood Work Result-1, Blood Pressure, Blood Work Result-2, Blood Work Result-3, Body mass index, Blood Work Result-4, Patient's age, and the presence of insurance. The goal is to develop a comprehensive prediction system for identifying sepsis risk in patients based on these key input variables.

## 1. Business Understanding

The primary objective of this project is to develop a predictive model for sepsis detection in patients within the Intensive Care Unit (ICU). Sepsis is a life-threatening condition, and early detection is crucial for timely intervention and improved patient outcomes. The business goal is to enhance patient care by providing healthcare professionals with a tool that can assess the likelihood of sepsis development based on key clinical indicators.  

The model will utilize input features such as Plasma glucose level, Blood Work Results, Blood Pressure, Body mass index, Patient's age, and insurance status. The predictions generated by the model will assist healthcare providers in identifying patients at a higher risk of developing sepsis, enabling prompt and targeted medical interventions.

By implementing this predictive model, the healthcare system aims to achieve the following objectives:

1) Early Intervention: Enable healthcare professionals to intervene early in cases with a high predicted risk of sepsis, leading to timely and appropriate medical care.
2) Resource Optimization: Efficiently allocate medical resources by focusing attention on patients identified as high-risk, potentially reducing the overall burden on healthcare facilities.
3) Improved Patient Outcomes: Contribute to better patient outcomes by preventing or minimizing the severity of sepsis through proactive medical management.

### 1.1. Qeustions and Objectives

#### Plasma Glucose Level

Objective: Investigate the distribution of plasma glucose levels among patients with and without sepsis.
Question: Is there a statistically significant difference in plasma glucose levels between sepsis and non-sepsis cases?

#### Blood Work Results

Objective: Compare the distributions of Blood Work Results for patients with and without sepsis.
Question: Are there specific patterns or thresholds in Blood Work Results associated with a higher likelihood of sepsis?

#### Blood Pressure

Objective: Examine the relationship between blood pressure values and the occurrence of sepsis.
Question: Are there identifiable trends or correlations between blood pressure levels and the likelihood of developing sepsis?

#### Body Mass Index (BMI)

Objective: Analyze the distribution of Body Mass Index among individuals with and without sepsis.
Question: Is there a correlation between BMI and the risk of sepsis?

#### Patient's Age

Objective: Explore the age distribution of patients with sepsis compared to those without.
Question: Is there a specific age group more susceptible to sepsis?

#### Insurance Status

Objective: Determine the percentage of patients with valid insurance among those with and without sepsis.
Question: Is there any correlation between insurance status and the likelihood of developing sepsis?

#### Overall Sepsis Prediction

Objective: Assess how well combined factors predict sepsis occurrence.
Question: Are certain combinations of variables more indicative of sepsis risk?

#### Model Performance

Objective: Evaluate the accuracy of the predictive model in identifying sepsis based on selected features.
Question: What are the key factors contributing to the model's performance or limitations?

### 1.2. Variables 

- ID (N/A): Unique number representing the patient ID.
- PRG (Attribute1): Plasma glucose level.
- PL (Attribute 2): Blood Work Result-1 in mu U/ml.
- PR (Attribute 3): Blood Pressure in mm Hg.
- SK (Attribute 4): Blood Work Result-2 in mm.
- TS (Attribute 5): Blood Work Result-3 in mu U/ml.
- M11 (Attribute 6): Body mass index (weight in kg/(height in m)^2).
- BD2 (Attribute 7): Blood Work Result-4 in mu U/ml.
- Age (Attribute 8): Patient's age in years.
- Insurance (N/A): Binary variable indicating whether a patient holds a valid insurance card.
- Sepssis (Target): The target variable indicating whether a patient in the Intensive Care Unit (ICU) will develop sepsis (Positive) or not (Negative).

#### More on Variables

The features (independent variables) in this dataset describe various physiological and clinical measurements of patients in the Intensive Care Unit (ICU), as well as demographic information. Here's an explanation of each feature:

PRG (Attribute1 - Plasma glucose level): This feature represents the level of glucose in the patient's plasma. Glucose levels are often monitored in medical settings as they can indicate conditions such as diabetes or stress response.

PL (Attribute 2 - Blood Work Result-1 in mu U/ml): This feature likely represents the results of a specific blood test, measured in milliunits per milliliter (mu U/ml).

PR (Attribute 3 - Blood Pressure in mm Hg): This feature represents the patient's blood pressure, measured in millimeters of mercury (mm Hg). Blood pressure is a crucial indicator of cardiovascular health and can help identify conditions such as hypertension or hypotension.

SK (Attribute 4 - Blood Work Result-2 in mm): Similar to Attribute 2, this likely represents another blood test result, but the specific test is not specified. It is measured in millimeters (mm).

TS (Attribute 5 - Blood Work Result-3 in mu U/ml): Another blood test result, measured in milliunits per milliliter (mu U/ml).

M11 (Attribute 6 - Body mass index): This feature represents the patient's body mass index (BMI), calculated as weight in kilograms divided by the square of height in meters. BMI is commonly used to assess whether a person has a healthy body weight relative to their height.

BD2 (Attribute 7 - Blood Work Result-4 in mu U/ml): Yet another blood test result, measured in milliunits per milliliter (mu U/ml).

Age (Attribute 8 - Patient's age in years): This feature indicates the age of the patient in years. Age can be an important factor in assessing overall health and susceptibility to certain conditions.

Insurance (N/A - Binary variable indicating whether a patient holds a valid insurance card): This binary variable indicates whether the patient holds a valid insurance card, which may be relevant for healthcare access and coverage.

The target variable, labeled "Sepsis," indicates whether a patient in the ICU will develop sepsis or not. Sepsis is a severe medical condition caused by the body's overwhelming response to an infection. It can lead to tissue damage, organ failure, and death if not treated promptly. The target variable is binary, with "Positive" indicating the patient will develop sepsis and "Negative" indicating they will not. Predicting sepsis development is crucial for timely intervention and improving patient outcomes in the ICU.

### 1.3. Hypotheses

1. **Plasma Glucose Levels and Sepsis:**
   - Null Hypothesis (H0): There is no significant difference in the distribution of plasma glucose levels between patients with sepsis and those without sepsis.
   - Alternative Hypothesis (H1): There is a significant difference in the distribution of plasma glucose levels between patients with sepsis and those without sepsis.

2. **Blood Work Results and Sepsis:**
   - H0: The distributions of Blood Work Results are similar for patients with and without sepsis.
   - H1: There is a significant difference in the distributions of Blood Work Results between patients with sepsis and those without sepsis.

3. **Blood Pressure Values and Sepsis:**
   - H0: There is no association between blood pressure values and the occurrence of sepsis.
   - H1: There is a significant relationship between blood pressure values and the occurrence of sepsis.

4. **Body Mass Index (BMI) and Sepsis:**
   - H0: The distribution of Body Mass Index is similar among individuals with and without sepsis.
   - H1: There is a significant difference in the distribution of Body Mass Index between individuals with sepsis and those without sepsis.

5. **Age Distribution and Sepsis:**
   - H0: The age distribution is the same for patients with sepsis and those without sepsis.
   - H1: There is a significant difference in the age distribution between patients with sepsis and those without sepsis.

6. **Insurance Status and Sepsis:**
   - H0: There is no difference in the percentage of patients with valid insurance between those with and without sepsis.
   - H1: There is a significant difference in the percentage of patients with valid insurance between those with sepsis and those without sepsis.

7. **Predictive Model and Sepsis Occurrence:**
   - H0: Combined factors do not predict the occurrence of sepsis.
   - H1: Combined factors significantly predict the occurrence of sepsis.

8. **Accuracy of Predictive Model:**
   - H0: The predictive model's accuracy in identifying sepsis based on selected features is not significantly different from random chance.
   - H1: The predictive model's accuracy in identifying sepsis based on selected features is significantly better than random chance.


## 2. Data Understanding

- First all necessary packages for a machine learning project, including data processing, visualization, model building, and evaluation were imported, and the environment for conducting various analyses and experiments were set up.

- Data has been loaded from two CSV files, checked for missing values (none found), and inspected for its structure and content, revealing that all variables are numerical except for 'Sepssis'; furthermore, exploratory data analysis (EDA) has been conducted, which includes summarizing statistical measures and identifying potential issues such as differing scales and non-normal distributions.

- **In the exploratory data analysis (EDA), the dataset df_train is examined comprehensively**

- Descriptive statistics are calculated, revealing no null values but indicating different scales and non-normal distributions across the data, suggesting the need for transformation.

- The prevalence of sepsis in the ICU is determined, with approximately 34.72% of patients diagnosed with sepsis.

- Histograms are plotted to visualize the distributions of various numerical variables, both overall and stratified by sepsis status.

- Independent samples t-tests are conducted to assess the significance of differences in plasma glucose levels and blood work results between patients with and without sepsis.

- The distributions of blood pressure, BMI, age, and insurance status are examined concerning sepsis status, with t-tests performed to evaluate significant differences.
- Finally, a correlation heatmap is generated to explore the relationships between numeric variables in the dataset. Overall, the analysis provides insights into the prevalence and characteristics of sepsis among ICU patients and identifies potential relationships and differences in various medical parameters between patients with and without sepsis.

## 3. Data Preparation

In the data preparation phase, several steps were undertaken to ensure the quality and reliability of the dataset. Firstly, missing values were assessed, revealing that the training dataset contained no missing values, thus obviating the need for any handling. Secondly, the skewness of numerical features was examined, uncovering both positive and negative skewness. To address this, RobustScaler was employed to mitigate skewness issues. Thirdly, the dataset was scrutinized for outliers using a function based on the Interquartile Range (IQR), with extreme outliers subsequently deleted. RobustScaler was then applied to manage remaining outliers. Finally, duplicacy within the dataset was checked. These meticulous steps were crucial in preparing the data for subsequent analysis or modeling tasks, ensuring its integrity and reliability.

## 4. Modeling 

In the modeling phase a comprehensive workflow for a binary classification task, particularly focusing on identifying sepsis in medical data. Initially, the target variable 'Sepssis' is encoded using LabelEncoder. Then, the numerical features are scaled using RobustScaler to handle outliers and skewness effectively. Feature selection is performed by defining the features (X) and the target variable (y), followed by splitting the data into training and testing sets. As the dataset is imbalanced, balancing is determined to be necessary, and Synthetic Minority Over-sampling Technique (SMOTE) is employed to balance the training data. A range of classification models, including Logistic Regression, Decision Tree, Random Forest, Support Vector Machine, K-Nearest Neighbors, and Gradient Boosting, are defined and tuned using GridSearchCV to identify the best-performing model. This workflow encompasses data preprocessing, feature selection, balancing, model selection, and hyperparameter tuning, ensuring a robust approach to the classification task.

## 5. Model Evaluation

In this section, the performance of various machine learning models on a validation set is evaluated, and scores for accuracy, precision, recall, and F1-score are collected. The results are sorted based on accuracy in decreasing order and printed for all models. Following this evaluation, predictions are made using the best-performing models, namely Logistic Regression and Gradient Boosting, on a test dataset. The predicted labels are then decoded and added as new columns to the test dataset. Additionally, the test dataset with predicted labels is saved as a CSV file, and the trained models, along with associated preprocessing objects like LabelEncoder and RobustScaler, are serialized and saved in a designated folder. This process concludes the model evaluation, prediction, and serialization steps, providing a comprehensive summary of the machine learning workflow.

## 6 FastAPI Application Development

An implementation of a FastAPI-based web service for predicting sepsis based on a set of input features was done. It first loads pre-trained machine learning models (gradient boosting and logistic regression) along with necessary preprocessing objects like a label encoder and a robust scaler. The input features for prediction are defined using a Pydantic model called Features, which includes various medical parameters like PRG, PL, PR, SK, TS, M11, BD2, age, and insurance status.

Upon receiving a POST request to the /predict_sepsis endpoint with the input features, the script converts the input features into a numpy array and normalizes them using the loaded RobustScaler. It then utilizes the pre-trained models to predict the likelihood of sepsis occurrence for the given input. The predictions from both the gradient boosting and logistic regression models are returned, along with their decoded labels, indicating whether sepsis is predicted or not.

Overall, this app provides a simple yet effective API for real-time sepsis prediction, leveraging machine learning models and FastAPI for seamless integration into various applications or healthcare systems.

## 7 Dockurization 

The Dockerfile sets up a container environment for a Python application. It begins by specifying the base image as Python 3.12.2 and sets the working directory within the container to /app. Then, it copies the requirements.txt file into the container and installs the dependencies listed in that file using pip. The entire project directory is then copied into the container. Additionally, it exposes port 8000, which is the port that the FastAPI application runs on. Finally, the CMD directive specifies the command to run the FastAPI application using uvicorn, with the host set to 0.0.0.0 and port set to 8000. This Dockerfile essentially creates an environment ready to run a FastAPI application within a Docker container.

## 8 Summary

This project focuses on predicting sepsis, a life-threatening medical condition, by leveraging a predictive model that considers various input features such as plasma glucose level, blood work results, blood pressure, body mass index (BMI), patient age, and insurance status. The primary objective is to develop a comprehensive prediction system to identify sepsis risk in patients within the Intensive Care Unit (ICU). This predictive model aims to enhance patient care by providing healthcare professionals with a tool to assess the likelihood of sepsis development based on key clinical indicators, enabling timely intervention and improved outcomes.

The project encompasses several phases, including business understanding, data understanding, data preparation, modeling, model evaluation, FastAPI application development, and Dockerization. Through exploratory data analysis (EDA), statistical tests, and hypothesis testing, the dataset's characteristics, prevalence of sepsis, and potential relationships between features and sepsis occurrence are examined. Machine learning models, including Logistic Regression, Decision Tree, Random Forest, and Gradient Boosting, are trained, tuned, and evaluated for sepsis prediction. Additionally, a FastAPI-based web service is implemented for real-time sepsis prediction, and a Dockerfile is created to containerize the application, facilitating easy deployment and scalability. Overall, this project aims to provide an effective solution for early sepsis detection, contributing to improved patient care and outcomes in clinical settings.


# Author:

Tirusew Ayenew Cheru
tirusew.ayenew@azubiafrica.org
tirusewchru@gmail.com

**Submission Links**

GitHub: Link: https://github.com/tirusew-7/Sepsis-Prediction-API-with-FastAPI

Article: Link: https://medium.com/@tirusewcheru/sepsis-prediction-with-fastapi-b9044839c098

Docker: Link: https://hub.docker.com/r/tirusew777/sepsis-prediction-app
